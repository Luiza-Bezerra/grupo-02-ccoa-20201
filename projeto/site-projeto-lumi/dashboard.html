<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>
	<script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    <link rel="stylesheet" href="css/dash.css">
    <title>Dashboard</title>
</head>
<body>
    
    <div class="header">
        <div class="container">
            <div>
                <img class="icon-ball" src="img/desk-lamp.png" alt="">
            </div>
            <div class="title-header">
               <b><span class="highlight" style="font-size: 30px;"><span style="color:  #ffd700;">Lumi</span>nous</span></b>
            </div>
            <div class="nav">
                <ul>
                    <li class="nav-dash"><a href="#">Dashboard</a></li>
                    <li class="nav-jogos"><a href="#">Controle</a></li>
                    <li class="nav-favoritos"><a href="filial.html">Cadastrar Filiais</a></li>
                    <li class="nav-dropdown">
                        <button class="dropbtn">
                            <img class="icon-user" src="img/user.png" alt=""><span class="ola">Olá, Vinicius</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="#">Conta</a>
                            <a class="doubt" href="#">Duvidas</a>
                            <a class="sign-out" href="#">Sair</a>
                          </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="input">
        <h2 style="float: left;">Filtrar Gráficos:</h2>
        <select  id="" class="input-conteudo">
            <option value="">Dia</option>
            <option value="">Mês</option>
            <option value="">Ano</option>

        </select>
        <input type="text" placeholder="Data Especifica(23/09/2020)"  class="input-conteudo">
    </div>
 
    <div class="title"><h1>Gráfico de Luminosidade</h1></div>
    <div class="grafico">
        <canvas id="c_grafico"></canvas>
    </div>
    <div class="footer">
        <div class="container-footer-left">
            <p><h2>Sobre a Luminous</h2></p>
            <p>A Luminous foi fundada em 2020, visando solucionar os problemas de gastos desnecessário de energia elétrica, percebemos que varias instituições podem economizar muito dinheiro somente cortando gastos relacionados a luz, então decidimos agir para que essas instituições possam economizar dinheiro através do controle desse gastos.</p>
        </div>
        <div class="container-footer-right">
            <div class="icons">
                <ul>
                   <li>  <img src="img/instagram.png"  class="logo" alt=""> </li> <img src="" alt="">
                   <li><img src="img/facebook.png"  class="logo" alt=""></li>
                   <li><img src="img/twitter.png" class="logo" alt=""></li>
                   <li><img src="img/linkedin.png" class="logo"  alt=""></li>
                </ul>
            </div>
                </div>
    </div>
    <div class="footer_copyright">
        © copyright <b>Luminous</b>. All Rights Reserved. <br>
        Design by <b>Equipe de Ti da Luminous.</b>
    </div>
</body>
</html>
<script>
 	var context = document.getElementById("c_grafico").getContext("2d");
		context.canvas.width = 1000;
		context.canvas.height = 300;
	var config = {
		type: 'line',
		data: {
			labels: [],
			datasets: [{
				label: 'Luminosidade',
				backgroundColor: window.chartColors.blue,
				borderColor: window.chartColors.blue,
				data: [],
				fill: false,
			}]
		},
		options: {
			responsive: true,
			title: {
				display: true,
				text: 'Gráfico de histórico de Luminosidade'
			},
			tooltips: {
				mode: 'index',
				intersect: false,
			},
			hover: {
				mode: 'nearest',
				intersect: true
			},
			scales: {
				xAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: 'Horário'
					}
				}],
				yAxes: [{
					display: true,
					scaleLabel: {
						display: true,
						labelString: 'Lux'
					}
				}]
			}
		}
	};

	// esse "sortearTemperatura()" será desnecessário quando usarmos o backend futuramente
	function sortearTemperatura() {
		var limiteMin = 0;
		var limiteMax = 2010;
		var minimoAbsoluto = Math.abs(limiteMin);
		return (Math.random() * (minimoAbsoluto+limiteMax) - minimoAbsoluto).toFixed(1);
	}

	function recuperarDadosIniciais() {

		// esse "registros" será recuperado do backend futuramente
		var registros = [
			{
				momento: '00:03:42',
				leitura: sortearTemperatura()
			},
			{
				momento: '00:03:52',
				leitura: sortearTemperatura()
			},
			{
				momento: '00:04:02',
				leitura: sortearTemperatura()
			},
			{
				momento: '00:04:12',
				leitura: sortearTemperatura()
			},
			{
				momento: '00:04:22',
				leitura: sortearTemperatura()
			},
			{
				momento: '00:04:32',
				leitura: sortearTemperatura()
			},
			{
				momento: '00:04:42',
				leitura: sortearTemperatura()
			}
		];

		var contador = 0;

		// registros.length é a quantidade de itens em "registros"
		while (contador < registros.length) {

			config.data.labels.push(registros[contador].momento);  // incluir um novo momento
			config.data.datasets[0].data.push(registros[contador].leitura);  // incluir uma nova leitura

			contador++;
		}

	}

	function receberNovasLeituras() {
		setTimeout(() => {
			
			// esses "agora" etc até "momentos" serão desnecessários quando usarmos o backend futuramente
			var agora = new Date();
			var hora = agora.getHours();
			var minuto = agora.getMinutes();
			var segundo = agora.getSeconds();
			var momento = `${hora>9?'':'0'}${hora}:${minuto>9?'':'0'}${minuto}:${segundo>9?'':'0'}${segundo}`;

			// esse "novoRegistro" será recuperado do backend futuramente
			var novoRegistro = {
				momento: momento,
				leitura: sortearTemperatura()
			};
			
			// tirando e colocando valores no gráfico
			config.data.labels.shift(); // apagar o primeiro
			config.data.labels.push(novoRegistro.momento); // incluir um novo momento
			config.data.datasets[0].data.shift();  // apagar o primeiro
			config.data.datasets[0].data.push(novoRegistro.leitura); // incluir uma nova leitura

			// Atualiza o gráfico
			window.graficoLinha.update();	

			// agendar a chamada da mesma função para daqui a 7 segundos
			receberNovasLeituras();

		}, 10000); // 7000 ms -> 7 segundos
	}

	function plotarGrafico() {
		// chamar os 7 últimos registros de leitura
		recuperarDadosIniciais();

		// criação do gráfico na página
		var ctx = document.getElementById('c_grafico').getContext('2d');
		window.graficoLinha = new Chart(ctx, config);

		// função que agenda a recuperação da última leitura para daqui a 7 segundos
		receberNovasLeituras();
	}

	// indicando que a função "plotarGrafico" será invocada assim que a página carregar
	window.onload = plotarGrafico;

</script>
